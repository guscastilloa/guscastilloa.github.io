/*!
 * Handles finding a text string anywhere in the slides and showing the next occurrence to the user
 * by navigatating to that slide and highlighting it.
 *
 * @author Jon Snyder <snyder.jon@gmail.com>, February 2013
 */
const Plugin=()=>{function e(){(s=document.createElement("div")).classList.add("searchbox"),s.style.position="absolute",s.style.top="10px",s.style.right="10px",s.style.zIndex=10,s.innerHTML='<input type="search" class="searchinput" placeholder="Search..." style="vertical-align: top;"/>\n\t\t</span>',(a=s.querySelector(".searchinput")).style.width="240px",a.style.fontSize="14px",a.style.padding="4px 6px",a.style.color="#000",a.style.background="#fff",a.style.borderRadius="2px",a.style.border="0",a.style.outline="0",a.style.boxShadow="0 2px 18px rgba(0, 0, 0, 0.2)",a.style["-webkit-appearance"]="none",r.getRevealElement().appendChild(s),a.addEventListener("keyup",function(e){switch(e.keyCode){case 13:e.preventDefault(),l(),u=!1;break;default:u=!0}},!1),n()}function t(){s||e(),s.style.display="inline",a.focus(),a.select()}function n(){s||e(),s.style.display="none",p&&p.remove()}function i(){s||e(),"inline"!==s.style.display?t():n()}function l(){if(u){var e=a.value;""===e?(p&&p.remove(),d=null):(p=new o("slidecontent"),d=p.apply(e),c=0)}d&&(d.length&&d.length<=c&&(c=0),d.length>c&&(r.slide(d[c].h,d[c].v),c++))}function o(e,t){var n=document.getElementById(e)||document.body,i=t||"EM",l=new RegExp("^(?:"+i+"|SCRIPT|FORM)$"),o=["#ff6","#a0ffff","#9f9","#f99","#f6f"],s=[],a=0,d="",c=[];this.setRegex=function(e){e=e.replace(/^[^\w]+|[^\w]+$/g,"").replace(/[^\w'-]+/g,"|"),d=new RegExp("("+e+")","i")},this.getRegex=function(){return d.toString().replace(/^\/\\b\(|\)\\b\/i$/g,"").replace(/\|/g," ")},this.hiliteWords=function(e){if(e!=undefined&&e&&d&&!l.test(e.nodeName)){if(e.hasChildNodes())for(var t=0;t<e.childNodes.length;t++)this.hiliteWords(e.childNodes[t]);var n,u;if(3==e.nodeType)if((n=e.nodeValue)&&(u=d.exec(n))){for(var p=e;null!=p&&"SECTION"!=p.nodeName;)p=p.parentNode;var f=r.getIndices(p),h=c.length,y=!1;for(t=0;t<h;t++)c[t].h===f.h&&c[t].v===f.v&&(y=!0);y||c.push(f),s[u[0].toLowerCase()]||(s[u[0].toLowerCase()]=o[a++%o.length]);var g=document.createElement(i);g.appendChild(document.createTextNode(u[0])),g.style.backgroundColor=s[u[0].toLowerCase()],g.style.fontStyle="inherit",g.style.color="#000";var v=e.splitText(u.index);v.nodeValue=v.nodeValue.substring(u[0].length),e.parentNode.insertBefore(g,v)}}},this.remove=function(){for(var e,t=document.getElementsByTagName(i);t.length&&(e=t[0]);)e.parentNode.replaceChild(e.firstChild,e)},this.apply=function(e){if(e!=undefined&&e)return this.remove(),this.setRegex(e),this.hiliteWords(n),c}}let r,s,a,d,c,u,p;return{id:"search",init:e=>{(r=e).registerKeyboardShortcut("CTRL + Shift + F","Search"),document.addEventListener("keydown",function(e){"F"==e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),i())},!1)},open:t}};export default Plugin;