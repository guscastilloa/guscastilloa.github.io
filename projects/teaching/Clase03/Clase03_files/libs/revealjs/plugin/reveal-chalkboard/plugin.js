function scriptPath(){var e;if(document.currentScript)e=document.currentScript.src;else{var t=document.querySelector('script[src$="/chalkboard/plugin.js"]');t&&(e=t.src)}return e===undefined?"":e.slice(0,e.lastIndexOf("/")+1)}window.RevealChalkboard=window.RevealChalkboard||{id:"RevealChalkboard",init:function(e){initChalkboard(e)},configure:function(e){configure(e)},toggleNotesCanvas:function(){toggleNotesCanvas()},toggleChalkboard:function(){toggleChalkboard()},colorIndex:function(){colorIndex()},colorNext:function(){colorNext()},colorPrev:function(){colorPrev()},clear:function(){clear()},reset:function(){reset()},resetAll:function(){resetAll()},updateStorage:function(){updateStorage()},getData:function(){return getData()},download:function(){download()}};var path=scriptPath();const initChalkboard=function(e){function t(e){switch((e.boardmarkerWidth||e.penWidth)&&(he=e.boardmarkerWidth||e.penWidth),e.chalkWidth&&(ue=e.chalkWidth),e.chalkEffect&&(ge=e.chalkEffect),e.rememberColor&&(fe=e.rememberColor),e.eraser&&(pe=e.eraser),e.boardmarkers&&(ve=e.boardmarkers),e.chalks&&(me=e.chalks),e.theme&&(ye=e.theme),ye){case"whiteboard":ie=["rgba(127,127,127,.1)",path+"img/whiteboard.png"],se=[C,C],pens=[ve,ve],ce={color:"rgb(127,127,255,0.1)",distance:40,width:2};break;case"chalkboard":default:ie=["rgba(127,127,127,.1)",path+"img/blackboard.png"],se=[C,E],pens=[ve,me],ce={color:"rgb(50,50,10,0.5)",distance:80,width:2}}(e.background&&(ie=e.background),e.grid!=undefined&&(ce=e.grid),e.toggleChalkboardButton!=undefined&&(ke=e.toggleChalkboardButton),e.toggleNotesButton!=undefined&&(Ce=e.toggleNotesButton),e.colorButtons!=undefined&&(Ee=e.colorButtons),e.boardHandle!=undefined&&(xe=e.boardHandle),e.transition&&(Se=e.transition),e.readOnly!=undefined&&(Oe=e.readOnly),e.messageType&&(De=e.messageType),Me&&(e.theme||e.background||e.grid))&&(document.getElementById(Me[1].id).style.background='url("'+ie[1]+'") repeat',D(1),T());return e}function n(e){document.querySelector("section[data-markdown]:not([data-markdown-parsed])")||document.querySelector('code[data-line-numbers*="|"]')?(console.log("Wait for markdown to be parsed and code to be highlighted"),setTimeout(n,500,e)):e()}function a(e){null!==Ue?e():(console.log("Wait for drawings to be loaded"),setTimeout(a,500,e))}function o(e,t){(!0===t||t>e.length)&&(t=e.length);var n=document.createElement("div");n.classList.add("palette");for(var a=document.createElement("ul"),o=0;o<t;o++){var r=document.createElement("li");r.setAttribute("data-color",o),r.innerHTML='<i class="fa fa-square"></i>',r.style.color=e[o].color,r.addEventListener("click",function(e){for(var t=e.target;!t.hasAttribute("data-color");)t=t.parentElement;ee(parseInt(t.getAttribute("data-color")))}),r.addEventListener("touchstart",function(e){for(var t=e.target;!t.hasAttribute("data-color");)t=t.parentElement;ee(parseInt(t.getAttribute("data-color")))}),a.appendChild(r)}return n.appendChild(a),n}function r(e){A(e,!0);var t=new CustomEvent(De);t.content={sender:"chalkboard-plugin",type:"selectboard",timestamp:Date.now()-Xe,mode:Ae,board:qe},document.dispatchEvent(t)}function i(t){var n=document.createElement("div");if(n.id=Me[t].id,n.classList.add("overlay"),n.setAttribute("data-prevent-swipe","true"),n.oncontextmenu=function(){return!1},n.style.cursor=pens[t][we[t]].cursor,Me[t].width=window.innerWidth,Me[t].height=window.innerHeight,Me[t].scale=1,Me[t].xOffset=0,Me[t].yOffset=0,"0"==t){n.style.background="rgba(0,0,0,0)",n.style.zIndex=24,n.style.opacity=1,n.style.visibility="visible",n.style.pointerEvents="none";document.querySelector(".slides");var a=e.getConfig().width/e.getConfig().height;if(Me[t].width>Me[t].height*a?Me[t].xOffset=(Me[t].width-Me[t].height*a)/2:Me[t].height>Me[t].width/a&&(Me[t].yOffset=(Me[t].height-Me[t].width/a)/2),Ee)(i=o(ve,Ee)).style.visibility="hidden",n.appendChild(i)}else{if(n.style.background='url("'+ie[t]+'") repeat',n.style.zIndex=26,n.style.opacity=0,n.style.visibility="hidden",Ee){var i=o(me,Ee);n.appendChild(i)}if(xe){var s=document.createElement("div");s.classList.add("boardhandle"),s.innerHTML='<ul><li><a id="previousboard" href="#" title="Previous board"><i class="fas fa-chevron-up"></i></a></li><li><a id="nextboard" href="#" title="Next board"><i class="fas fa-chevron-down"></i></a></li></ul>',s.querySelector("#previousboard").addEventListener("click",function(e){e.preventDefault(),r(qe-1)}),s.querySelector("#nextboard").addEventListener("click",function(e){e.preventDefault(),r(qe+1)}),s.querySelector("#previousboard").addEventListener("touchstart",function(e){e.preventDefault(),r(qe-1)}),s.querySelector("#nextboard").addEventListener("touchstart",function(e){e.preventDefault(),r(qe+1)}),n.appendChild(s)}}var d=document.createElement("img");d.src=pe.src,d.id="sponge",d.style.visibility="hidden",d.style.position="absolute",n.appendChild(d),Me[t].sponge=d;var l=document.createElement("canvas");l.width=Me[t].width,l.height=Me[t].height,l.setAttribute("data-chalkboard",t),l.style.cursor=pens[t][we[t]].cursor,n.appendChild(l),Me[t].canvas=l,Me[t].context=l.getContext("2d"),$(n),document.querySelector(".reveal").appendChild(n),Me[t].container=n}function s(e){var t=!1;try{for(var n=JSON.parse(e),a=0;a<n.length;a++)Me[a].width==n[a].width&&Me[a].height==n[a].height||(Me[a].scale=Math.min(Me[a].width/n[a].width,Me[a].height/n[a].height),Me[a].xOffset=(Me[a].width-n[a].width*Me[a].scale)/2,Me[a].yOffset=(Me[a].height-n[a].height*Me[a].scale)/2),Te.readOnly&&(Me[a].container.style.cursor="default",Me[a].canvas.style.cursor="default");t=!0,Ke=n}catch(o){console.warn("Cannot initialise storage!")}return t}function d(e){var t=new XMLHttpRequest;t.onload=function(){4===t.readyState&&404!=t.status?(Ue=s(t.responseText),c(),console.log("Drawings loaded from file")):(Te.readOnly=undefined,Oe=undefined,console.warn("Failed to get file "+e+". ReadyState: "+t.readyState+", Status: "+t.status),Ue=!1)},t.open("GET",e,!0);try{t.send()}catch(n){Te.readOnly=undefined,Oe=undefined,console.warn("Failed to get file "+e+". Make sure that the presentation and the file are served by a HTTP server and the file can be found there. "+n),Ue=!1}}function l(e){e?(c(),Je=null):(Je&&clearTimeout(Je),Je=setTimeout(l,1e3,!0))}function c(){var e=JSON.stringify(Ke);return Te.storage&&sessionStorage.setItem(Te.storage,e),e}function h(e){e.time=Date.now()-Xe,1==Ae&&(e.board=qe);for(var t=f(),n=t.events.length;n>0&&e.time<t.events[n-1].time;)n--;t.events.splice(n,0,e),t.duration=Math.max(t.duration,Date.now()-Xe)+1,l()}function u(){for(var e=0;e<2;e++)for(var t=Ke[e].data.length-1;t>=0;t--)0==Ke[e].data[t].events.length&&Ke[e].data.splice(t,1);return c()}function g(){var e=document.createElement("a");document.body.appendChild(e);try{e.download="chalkboard.json";var t=new Blob([u()],{type:"application/json"});e.href=window.URL.createObjectURL(t)}catch(n){e.innerHTML+=" ("+n+")"}e.click(),document.body.removeChild(e)}function f(t,n){n==undefined&&(n=Ae),t||(t=He);for(var a=0;a<Ke[n].data.length;a++)if(Ke[n].data[a].slide.h===t.h&&Ke[n].data[a].slide.v===t.v&&Ke[n].data[a].slide.f===t.f)return Ke[n].data[a];var o=Number(e.getCurrentSlide().getAttribute("data-pdf-page-number"));return Ke[n].data.push({slide:t,page:o,events:[],duration:0}),Ke[n].data[Ke[n].data.length-1]}function p(e){e||(e=He);for(var t=0,n=0;n<2;n++)for(var a=0;a<Ke[n].data.length;a++)if(Ke[n].data[a].slide.h===e.h&&Ke[n].data[a].slide.v===e.v&&Ke[n].data[a].slide.f===e.f){t=Math.max(t,Ke[n].data[a].duration);break}return t}function v(){for(var t=e.getSlides(),n=0,a=0;a<t.length;a++){t[a].setAttribute("data-pdf-page-number",n.toString());for(var o=t[a].querySelectorAll(".fragment:not([data-fragment-index])").length,r=t[a].querySelectorAll(".fragment[data-fragment-index]"),i=0;i<r.length;i++)Number(r[i].getAttribute("data-fragment-index"))+1>o&&(o=Number(r[i].getAttribute("data-fragment-index"))+1);n+=o+1}}function m(){if(0!=Ke[1].data.length){console.log("Create printout(s) for "+Ke[1].data.length+" slides"),Me[0].container.style.opacity=0,Me[0].container.style.visibility="hidden";var t=new Image;t.onload=function(){for(var n=e.getSlides(),a=Ke[1].data.length-1;a>=0;a--){console.log("Create printout for slide "+Ke[1].data[a].slide.h+"."+Ke[1].data[a].slide.v);var o=w(f(Ke[1].data[a].slide,1),t);k(n[Ke[1].data[a].page],o)}},t.src=ie[1]}}function b(e){var t=document.createElement("canvas"),n=t.getContext("2d");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),t}function y(e,t,n){var a=t.findIndex(e=>e.board===n);if(-1===a){var o=b(e);t.length?n<t[0].board?(a=0,t.unshift({board:n,canvas:o})):n>t[t.length-1].board&&(a=t.length,t.push({board:n,canvas:o})):(a=0,t.push({board:n,canvas:o}))}return t[a].canvas}function w(t,n){var a=e.getConfig().width,o=e.getConfig().height,r=1,i=0,s=0;a==Ke[1].width&&o==Ke[1].height||(r=Math.min(a/Ke[1].width,o/Ke[1].height),i=(a-Ke[1].width*r)/2,s=(o-Ke[1].height*r)/2),Ae=1,qe=0;var d=[],l=document.createElement("canvas");l.width=a,l.height=o;var c=l.getContext("2d");c.fillStyle=c.createPattern(n,"repeat"),c.rect(0,0,a,o),c.fill();for(var h=0;h<t.events.length;h++)switch(t.events[h].type){case"draw":se[1](y(l,d,qe).getContext("2d"),i+t.events[h].x1*r,s+t.events[h].y1*r,i+t.events[h].x2*r,s+t.events[h].y2*r,s+t.events[h].color);break;case"erase":x(y(l,d,qe).getContext("2d"),i+t.events[h].x*r,s+t.events[h].y*r);break;case"selectboard":A(t.events[h].board);break;case"clear":y(l,d,qe).getContext("2d").clearRect(0,0,a,o),y(l,d,qe).getContext("2d").fill()}return d=d.sort((e,t)=>e.board>t.board?1:-1),Ae=0,d}function k(t,n){for(var a=t.parentElement.parentElement,o=t.parentElement.nextElementSibling,r=0;r<n.length;r++){var i=document.createElement("div");i.classList.add("pdf-page"),i.style.height=e.getConfig().height,i.append(n[r].canvas),null!=o?a.insertBefore(i,o):a.append(i)}}function C(e,t,n,a,o,r){r==undefined&&(r=we[Ae]),e.lineWidth=he,e.lineCap="round",e.strokeStyle=ve[r].color,e.beginPath(),e.moveTo(t,n),e.lineTo(a,o),e.stroke()}function E(e,t,n,a,o,r){r==undefined&&(r=we[Ae]);var i=ue;e.lineWidth=i,e.lineCap="round",e.fillStyle=me[r].color,e.strokeStyle=me[r].color;var s=1;e.strokeStyle=e.strokeStyle.replace(/[\d\.]+\)$/g,s+")"),e.beginPath(),e.moveTo(t,n),e.lineTo(a,o),e.stroke();for(var d=Math.round(Math.sqrt(Math.pow(a-t,2)+Math.pow(o-n,2))/(5/i)),l=(a-t)/d,c=(o-n)/d,h=0;h<d;h++)if(ge>.9*Math.random()){var u=n+h*c,g=t+h*l+(Math.random()-.5)*i*1.2,f=u+(Math.random()-.5)*i*1.2;e.clearRect(g,f,2*Math.random()+2,Math.random()+1)}}function x(e,t,n){e.save(),e.beginPath(),e.arc(t,n,pe.radius,0,2*Math.PI,!1),e.clip(),e.clearRect(t-pe.radius-1,n-pe.radius-1,2*pe.radius+2,2*pe.radius+2),e.restore(),1==Ae&&ce&&L(t,n,pe.radius)}function S(){clearTimeout(ze),ze=null,Me[0].sponge.style.visibility="hidden",Me[1].sponge.style.visibility="hidden",Me[1].container.style.opacity=1,Me[1].container.style.visibility="visible",Ae=1}function O(){clearTimeout(ze),ze=null,Me[0].sponge.style.visibility="hidden",Me[1].sponge.style.visibility="hidden",Me[1].container.style.opacity=0,Me[1].container.style.visibility="hidden",Pe=null,Be=null,Ae=0}function D(e){0==e&&clearTimeout(je),Me[e].context.clearRect(0,0,Me[e].width,Me[e].height),1==e&&ce&&T()}function T(){var e=Me[1].context;Me[1].scale=Math.min(Me[1].width/Ke[1].width,Me[1].height/Ke[1].height),Me[1].xOffset=(Me[1].width-Ke[1].width*Me[1].scale)/2,Me[1].yOffset=(Me[1].height-Ke[1].height*Me[1].scale)/2;for(var t=Me[1].scale,n=(Me[1].xOffset,Me[1].yOffset,ce.distance*t),a=Me[1].width/2-n/2-Math.floor((Me[1].width-n)/2/n)*n;a<Me[1].width;a+=n)e.beginPath(),e.lineWidth=ce.width*t,e.lineCap="round",e.fillStyle=ce.color,e.strokeStyle=ce.color,e.moveTo(a,0),e.lineTo(a,Me[1].height),e.stroke();for(var o=Me[1].height/2-n/2-Math.floor((Me[1].height-n)/2/n)*n;o<Me[1].height;o+=n)e.beginPath(),e.lineWidth=ce.width*t,e.lineCap="round",e.fillStyle=ce.color,e.strokeStyle=ce.color,e.moveTo(0,o),e.lineTo(Me[1].width,o),e.stroke()}function L(e,t,n){var a=Me[1].context;Me[1].scale=Math.min(Me[1].width/Ke[1].width,Me[1].height/Ke[1].height),Me[1].xOffset=(Me[1].width-Ke[1].width*Me[1].scale)/2,Me[1].yOffset=(Me[1].height-Ke[1].height*Me[1].scale)/2;for(var o=Me[1].scale,r=(Me[1].xOffset,Me[1].yOffset,ce.distance*o),i=Me[1].width/2-r/2-Math.floor((Me[1].width-r)/2/r)*r,s=i+r*Math.ceil((e-n-i)/r);s<=i+r*Math.floor((e+n-i)/r);s+=r)a.beginPath(),a.lineWidth=ce.width*o,a.lineCap="round",a.fillStyle=ce.color,a.strokeStyle=ce.color,a.moveTo(s,t-Math.sqrt(n*n-(e-s)*(e-s))),a.lineTo(s,t+Math.sqrt(n*n-(e-s)*(e-s))),a.stroke();for(var d=Me[1].height/2-r/2-Math.floor((Me[1].height-r)/2/r)*r,l=d+r*Math.ceil((t-n-d)/r);l<=d+r*Math.floor((t+n-d)/r);l+=r)a.beginPath(),a.lineWidth=ce.width*o,a.lineCap="round",a.fillStyle=ce.color,a.strokeStyle=ce.color,a.moveTo(e-Math.sqrt(n*n-(t-l)*(t-l)),l),a.lineTo(e+Math.sqrt(n*n-(t-l)*(t-l)),l),a.stroke()}function M(e){e>=pens[Ae].length&&(e=0),we[Ae]=e,Me[Ae].canvas.style.cursor=pens[Ae][we[Ae]].cursor}function A(e,t){qe!=e&&(qe=e,q(e),t&&h({type:"selectboard"}))}function q(e){D(1);for(var t=f(He,1),n=0;n<t.events.length&&t.events[n].time<Date.now()-Xe;)e==t.events[n].board&&X(1,t.events[n],Date.now()-Xe),n++}function N(){return we[Ae]=(we[Ae]+1)%pens[Ae].length,we[Ae]}function I(){return we[Ae]=(we[Ae]+(pens[Ae].length-1))%pens[Ae].length,we[Ae]}function P(){var e=Ge.shift();switch(Xe=Date.now()-e.content.timestamp,Ae<e.content.mode?S():Ae>e.content.mode&&O(),qe!=e.content.board&&q(qe=e.content.board),e.content.type){case"showChalkboard":S();break;case"closeChalkboard":O();break;case"erase":j(e.content.x,e.content.y);break;case"draw":K(e.content.fromX,e.content.fromY,e.content.toX,e.content.toY,e.content.color);break;case"clear":Z();break;case"selectboard":A(e.content.board,!0);break;case"resetSlide":ae();break;case"init":Ke=e.content.storage;for(var t=0;t<2;t++)Me[t].scale=Math.min(Me[t].width/Ke[t].width,Me[t].height/Ke[t].height),Me[t].xOffset=(Me[t].width-Ke[t].width*Me[t].scale)/2,Me[t].yOffset=(Me[t].height-Ke[t].height*Me[t].scale)/2;D(0),D(1),Fe||(je=setTimeout(W,Se,p(),0)),1==Ae&&0==e.content.mode&&setTimeout(O,Se+50),0==Ae&&1==e.content.mode&&setTimeout(S,Se+50),Ae=e.content.mode,qe=e.content.board}Ge.length>0?P():l()}function B(){oe(!0),Xe=Date.now()}function W(e,t){Xe=Date.now()-e,O(),Ae=0,qe=0;for(var n=0;n<2;n++){D(n);for(var a=f(He,n),o=0;o<a.events.length&&a.events[o].time<Date.now()-Xe;)X(n,a.events[o],e),o++;for(;Fe&&o<a.events.length;)Ye[n].push(setTimeout(X,a.events[o].time-(Date.now()-Xe),n,a.events[o],e)),o++}t!=undefined&&(Ae=t),1==Ae&&S()}function R(){for(var e=0;e<2;e++){for(var t=0;t<Ye[e].length;t++)clearTimeout(Ye[e][t]);Ye[e]=[]}}function X(e,t,n){switch(t.type){case"open":n<=t.time?S():Ae=1;break;case"close":n<t.time?O():Ae=0;break;case"clear":D(e);break;case"selectboard":A(t.board);break;case"draw":H(e,t,n);break;case"erase":Y(e,t,n)}}function H(e,t){var n=Me[e].context,a=Me[e].scale,o=Me[e].xOffset,r=Me[e].yOffset;se[e](n,o+t.x1*a,r+t.y1*a,o+t.x2*a,r+t.y2*a,t.color)}function Y(e,t){var n=Me[e].context,a=Me[e].scale,o=Me[e].xOffset,r=Me[e].yOffset;x(n,o+t.x*a,r+t.y*a)}function z(e,t){We=!1,Re=!0,Me[Ae].sponge.style.visibility="visible",j(e,t)}function j(e,t){var n=Me[Ae].context,a=Me[Ae].scale,o=Me[Ae].xOffset,r=Me[Ae].yOffset;Me[Ae].sponge.style.left=e*a+o-pe.radius+"px",Me[Ae].sponge.style.top=t*a+r-2*pe.radius+"px",h({type:"erase",x:e,y:t}),e*a+o>0&&t*a+r>0&&e*a+o<Me[Ae].width&&t*a+r<Me[Ae].height&&x(n,e*a+o,t*a+r)}function J(){Re=!1,Me[Ae].sponge.style.visibility="hidden"}function F(e,t){We=!0;Me[Ae].context;var n=Me[Ae].scale,a=Me[Ae].xOffset,o=Me[Ae].yOffset;Pe=e*n+a,Be=t*n+o}function K(e,t,n,a,o){var r=Me[Ae].context,i=Me[Ae].scale,s=Me[Ae].xOffset,d=Me[Ae].yOffset;h({type:"draw",color:o,x1:e,y1:t,x2:n,y2:a}),e*i+s>0&&t*i+d>0&&e*i+s<Me[Ae].width&&t*i+d<Me[Ae].height&&n*i+s>0&&a*i+d>0&&n*i+s<Me[Ae].width&&a*i+d<Me[Ae].height&&se[Ae](r,e*i+s,t*i+d,n*i+s,a*i+d,o)}function U(){We=!1}function $(e){e.addEventListener("touchstart",function(e){if(e.preventDefault(),!Oe&&e.target.getAttribute("data-chalkboard")==Ae){var t=Me[Ae].scale,n=Me[Ae].xOffset,a=Me[Ae].yOffset,o=e.touches[0];Ne=o.pageX,Ie=o.pageY,F((Ne-n)/t,(Ie-a)/t),ze=setTimeout(z,500,(Ne-n)/t,(Ie-a)/t)}},!!de&&{passive:!1}),e.addEventListener("touchmove",function(e){if(e.preventDefault(),clearTimeout(ze),ze=null,We||Re){var t,n=Me[Ae].scale,a=Me[Ae].xOffset,o=Me[Ae].yOffset,r=e.touches[0];if(Ne=r.pageX,(Ie=r.pageY)<Me[Ae].height&&Ne<Me[Ae].width&&"erase"==event.type&&(Me[Ae].sponge.style.left=Ne-pe.radius+"px",Me[Ae].sponge.style.top=Ie-pe.radius+"px"),We)K((Pe-a)/n,(Be-o)/n,(Ne-a)/n,(Ie-o)/n,we[Ae]),(t=new CustomEvent(De)).content={sender:"chalkboard-plugin",type:"draw",timestamp:Date.now()-Xe,mode:Ae,board:qe,fromX:(Pe-a)/n,fromY:(Be-o)/n,toX:(Ne-a)/n,toY:(Ie-o)/n,color:we[Ae]},document.dispatchEvent(t),Pe=Ne,Be=Ie;else j((Ne-a)/n,(Ie-o)/n),(t=new CustomEvent(De)).content={sender:"chalkboard-plugin",type:"erase",timestamp:Date.now()-Xe,mode:Ae,board:qe,x:(Ne-a)/n,y:(Ie-o)/n},document.dispatchEvent(t)}},!1),e.addEventListener("touchend",function(e){e.preventDefault(),clearTimeout(ze),ze=null,Me[Ae].sponge.style.visibility="hidden",U()},!1),e.addEventListener("mousedown",function(e){if(e.preventDefault(),!Oe&&e.target.getAttribute("data-chalkboard")==Ae){var t=Me[Ae].scale,n=Me[Ae].xOffset,a=Me[Ae].yOffset;if(Ne=e.pageX,Ie=e.pageY,2==e.button||1==e.button){z((Ne-n)/t,(Ie-a)/t);var o=new CustomEvent(De);o.content={sender:"chalkboard-plugin",type:"erase",timestamp:Date.now()-Xe,mode:Ae,board:qe,x:(Ne-n)/t,y:(Ie-a)/t},document.dispatchEvent(o)}else F((Ne-n)/t,(Ie-a)/t)}}),e.addEventListener("mousemove",function(e){if(e.preventDefault(),We||Re){var t,n=Me[Ae].scale,a=Me[Ae].xOffset,o=Me[Ae].yOffset;if(Ne=e.pageX,Ie=e.pageY,We)K((Pe-a)/n,(Be-o)/n,(Ne-a)/n,(Ie-o)/n,we[Ae]),(t=new CustomEvent(De)).content={sender:"chalkboard-plugin",type:"draw",timestamp:Date.now()-Xe,mode:Ae,board:qe,fromX:(Pe-a)/n,fromY:(Be-o)/n,toX:(Ne-a)/n,toY:(Ie-o)/n,color:we[Ae]},document.dispatchEvent(t),Pe=Ne,Be=Ie;else j((Ne-a)/n,(Ie-o)/n),(t=new CustomEvent(De)).content={sender:"chalkboard-plugin",type:"erase",timestamp:Date.now()-Xe,mode:Ae,board:qe,x:(Ne-a)/n,y:(Ie-o)/n},document.dispatchEvent(t)}}),e.addEventListener("mouseup",function(e){e.preventDefault(),Me[Ae].canvas.style.cursor=pens[Ae][we[Ae]].cursor,(We||Re)&&(U(),J())})}function G(){var e=Date.now()-Xe;Fe||(e=p());for(var t=0;t<2;t++)Me[t].width=window.innerWidth,Me[t].height=window.innerHeight,Me[t].canvas.width=Me[t].width,Me[t].canvas.height=Me[t].height,Me[t].context.canvas.width=Me[t].width,Me[t].context.canvas.height=Me[t].height,Me[t].scale=Math.min(Me[t].width/Ke[t].width,Me[t].height/Ke[t].height),Me[t].xOffset=(Me[t].width-Ke[t].width*Me[t].scale)/2,Me[t].yOffset=(Me[t].height-Ke[t].height*Me[t].scale)/2;W(e,Ae,!0)}function Q(){if(!Oe)if(1==Ae)V(),notescanvas.style.background=ie[0],notescanvas.style.pointerEvents="auto";else if("none"!=notescanvas.style.pointerEvents)Ee&&(notescanvas.querySelector(".palette").style.visibility="hidden"),notescanvas.style.background="rgba(0,0,0,0)",notescanvas.style.pointerEvents="none";else{Ee&&(notescanvas.querySelector(".palette").style.visibility="visible"),notescanvas.style.background=ie[0],notescanvas.style.pointerEvents="auto";var e=0;we[Ae]&&(e=we[Ae]),M(e,!0)}}function V(){if(1==Ae)Oe||h({type:"close"}),O(),(e=new CustomEvent(De)).content={sender:"chalkboard-plugin",type:"closeChalkboard",timestamp:Date.now()-Xe,mode:0,board:qe},document.dispatchEvent(e);else if(S(),!Oe){var e;h({type:"open"}),(e=new CustomEvent(De)).content={sender:"chalkboard-plugin",type:"showChalkboard",timestamp:Date.now()-Xe,mode:1,board:qe},document.dispatchEvent(e);var t=0;fe[Ae]&&(t=we[Ae]),M(t,!0)}}function Z(){h({type:"clear"}),D(Ae)}function _(){if(!Oe){Z();var e=new CustomEvent(De);e.content={sender:"chalkboard-plugin",type:"clear",timestamp:Date.now()-Xe,mode:Ae,board:qe},document.dispatchEvent(e)}}function ee(e){Oe||M(e,!0)}function te(){if(!Oe){M(N(),!0)}}function ne(){if(!Oe){M(I(),!0)}}function ae(){var e;Xe=Date.now(),O(),D(0),D(1),Ae=1,(e=f()).duration=0,e.events=[],Ae=0,(e=f()).duration=0,e.events=[],c()}function oe(e){if(e||confirm("Please confirm to delete chalkboard drawings on this slide!")){R(),ae();var t=new CustomEvent(De);t.content={sender:"chalkboard-plugin",type:"resetSlide",timestamp:Date.now()-Xe,mode:Ae,board:qe},document.dispatchEvent(t)}}function re(t){if(t||confirm("Please confirm to delete all chalkboard drawings!")){R(),Xe=Date.now(),D(0),D(1),1==Ae&&O(),Ke=[{width:e.getConfig().width,height:e.getConfig().height,data:[]},{width:e.getConfig().width,height:e.getConfig().height,data:[]}],Te.storage&&sessionStorage.setItem(Te.storage,null);var n=new CustomEvent(De);n.content={sender:"chalkboard-plugin",type:"init",timestamp:Date.now()-Xe,storage:Ke,mode:Ae,board:qe},document.dispatchEvent(n)}}var ie,se,de=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){de=!0}}))}catch(Qe){}var le,ce=!1,he=3,ue=7,ge=1,fe=[!0,!1],pe={src:path+"img/sponge.png",radius:20},ve=[{color:"rgba(100,100,100,1)",cursor:"url("+path+"img/boardmarker-black.png), auto"},{color:"rgba(30,144,255, 1)",cursor:"url("+path+"img/boardmarker-blue.png), auto"},{color:"rgba(220,20,60,1)",cursor:"url("+path+"img/boardmarker-red.png), auto"},{color:"rgba(50,205,50,1)",cursor:"url("+path+"img/boardmarker-green.png), auto"},{color:"rgba(255,140,0,1)",cursor:"url("+path+"img/boardmarker-orange.png), auto"},{color:"rgba(150,0,20150,1)",cursor:"url("+path+"img/boardmarker-purple.png), auto"},{color:"rgba(255,220,0,1)",cursor:"url("+path+"img/boardmarker-yellow.png), auto"}],me=[{color:"rgba(255,255,255,0.5)",cursor:"url("+path+"img/chalk-white.png), auto"},{color:"rgba(96, 154, 244, 0.5)",cursor:"url("+path+"img/chalk-blue.png), auto"},{color:"rgba(237, 20, 28, 0.5)",cursor:"url("+path+"img/chalk-red.png), auto"},{color:"rgba(20, 237, 28, 0.5)",cursor:"url("+path+"img/chalk-green.png), auto"},{color:"rgba(220, 133, 41, 0.5)",cursor:"url("+path+"img/chalk-orange.png), auto"},{color:"rgba(220,0,220,0.5)",cursor:"url("+path+"img/chalk-purple.png), auto"},{color:"rgba(255,220,0,0.5)",cursor:"url("+path+"img/chalk-yellow.png), auto"}],be={toggleNotesCanvas:{keyCode:67,key:"C",description:"Toggle notes canvas"},toggleChalkboard:{keyCode:66,key:"B",description:"Toggle chalkboard"},clear:{keyCode:46,key:"DEL",description:"Clear drawings on slide"},resetAll:{keyCode:8,key:"BACKSPACE",description:"Reset all drawings"},colorNext:{keyCode:88,key:"X",description:"Next color"},colorPrev:{keyCode:89,key:"Y",description:"Previous color"},download:{keyCode:68,key:"D",description:"Download drawings"}},ye="chalkboard",we=[0,0],ke=!1,Ce=!1,Ee=!0,xe=!0,Se=800,Oe=!1,De="broadcast",Te=t(e.getConfig().chalkboard||{});if(Te.keyBindings)for(var Le in Te.keyBindings)be[Le]=Te.keyBindings[Le];ke&&(console.warn("toggleChalkboardButton is deprecated, use customcontrols plugin instead!"),(le=document.createElement("div")).className="chalkboard-button",le.id="toggle-chalkboard",le.style.visibility="visible",le.style.position="absolute",le.style.zIndex=30,le.style.fontSize="24px",le.style.left=ke.left||"30px",le.style.bottom=ke.bottom||"30px",le.style.top=ke.top||"auto",le.style.right=ke.right||"auto",le.innerHTML='<a href="#" title="Toggle chalkboard ('+be.toggleChalkboard.key+')" onclick="RevealChalkboard.toggleChalkboard(); return false;"><i class="fa fa-pen-square"></i></a>',document.querySelector(".reveal").appendChild(le));Ce&&(console.warn("toggleNotesButton is deprecated, use customcontrols plugin instead!"),(le=document.createElement("div")).className="chalkboard-button",le.id="toggle-notes",le.style.position="absolute",le.style.zIndex=30,le.style.fontSize="24px",le.style.left=Ce.left||"70px",le.style.bottom=Ce.bottom||"30px",le.style.top=Ce.top||"auto",le.style.right=Ce.right||"auto",le.innerHTML='<a href="#" title="Toggle slide annotation ('+be.toggleNotesCanvas.key+')" onclick="RevealChalkboard.toggleNotesCanvas(); return false;"><i class="fa fa-pen"></i></a>',document.querySelector(".reveal").appendChild(le));var Me=[{id:"notescanvas"},{id:"chalkboard"}];i(0),i(1);var Ae=0,qe=0,Ne=0,Ie=0,Pe=null,Be=null,We=!1,Re=!1,Xe=Date.now(),He={h:0,v:0},Ye=[[],[]],ze=null,je=null,Je=null,Fe=!1,Ke=[{width:e.getConfig().width,height:e.getConfig().height,data:[]},{width:e.getConfig().width,height:e.getConfig().height,data:[]}],Ue=null;Te.storage&&(Ue=s(sessionStorage.getItem(Te.storage))),Ue||null==Te.src||d(Te.src);var $e=/print-pdf/gi.test(window.location.search),Ge=[];for(var Le in document.addEventListener("received",function(e){e.content&&"chalkboard-plugin"==e.content.sender&&(Ge.push(e),console.log(JSON.stringify(e))),1==Ge.length&&P()}),document.addEventListener("welcome",function(e){var t=new CustomEvent(De);t.content={sender:"chalkboard-plugin",recipient:e.id,type:"init",timestamp:Date.now()-Xe,storage:Ke,mode:Ae,board:qe},document.dispatchEvent(t)}),document.addEventListener("seekplayback",function(e){R(),Fe&&0!=e.timestamp||W(e.timestamp)}),document.addEventListener("startplayback",function(e){R(),Fe=!0,W(e.timestamp)}),document.addEventListener("stopplayback",function(){Fe=!1,R()}),document.addEventListener("startrecording",function(){B()}),e.addEventListener("pdf-ready",function(){a(m)}),e.addEventListener("ready",function(){if(!$e){if(window.addEventListener("resize",G),Xe=Date.now()-p(),He=e.getIndices(),Fe||W(p(),0),e.isAutoSliding()){var t=new CustomEvent("startplayback");t.timestamp=0,document.dispatchEvent(t)}c(),n(v)}}),e.addEventListener("slidechanged",function(){if(!$e&&(Xe=Date.now()-p(),He=e.getIndices(),O(),qe=0,D(0),D(1),Fe||(je=setTimeout(W,Se,p(),0)),e.isAutoSliding())){var t=new CustomEvent("startplayback");t.timestamp=0,document.dispatchEvent(t)}}),e.addEventListener("fragmentshown",function(){if(!$e)if(Xe=Date.now()-p(),He=e.getIndices(),O(),qe=0,D(0),D(1),e.isAutoSliding()){var t=new CustomEvent("startplayback");t.timestamp=0,document.dispatchEvent(t)}else Fe||W(p(),0)}),e.addEventListener("fragmenthidden",function(){$e||(Xe=Date.now()-p(),He=e.getIndices(),O(),qe=0,D(0),D(1),e.isAutoSliding()?document.dispatchEvent(new CustomEvent("stopplayback")):Fe||(W(p()),O()))}),e.addEventListener("autoslideresumed",function(){var e=new CustomEvent("startplayback");e.timestamp=0,document.dispatchEvent(e)}),e.addEventListener("autoslidepaused",function(){document.dispatchEvent(new CustomEvent("stopplayback")),W(p(),0)}),this.toggleNotesCanvas=Q,this.toggleChalkboard=V,this.colorIndex=ee,this.colorNext=te,this.colorPrev=ne,this.clear=_,this.reset=oe,this.resetAll=re,this.download=g,this.updateStorage=c,this.getData=u,this.configure=t,be)be[Le]&&e.addKeyBinding(be[Le],RevealChalkboard[Le]);return this};